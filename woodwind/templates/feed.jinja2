{% extends "base.jinja2" %}
{% block head %}
  <script src="{{url_for('static', filename='feed.js', version='2015-02-19')}}"></script>

  {% if current_user and current_user.settings
        and current_user.settings.get('reply-method') == 'indie-config' %}
    <script src="{{url_for('static', filename='indieconfig.js')}}"></script>
    <script src="{{url_for('static', filename='webaction.js')}}"></script>
  {% endif %}

{% endblock head %}

{% block header %}
  {% if current_user.is_authenticated() %}
    <form action="{{ url_for('.subscribe') }}" method="POST">
      <input type="url" id="origin" name="origin" placeholder="Subscribe to URL" />
    </form>
  {% endif %}
{% endblock header %}

{% block body %}

  {% for entry in entries %}
    {% for context in entry.reply_context %}
      <article class="reply-context">
        <header>
          {% if context.author_photo %}
            <img src="{{context.author_photo}}"/>
          {% endif %}
          {% if context.author_name %}
            {{ context.author_name }} -
          {% endif %}
          {{ context.permalink | domain_for_url }}
        </header>
        {% if context.title %}
          <h1>{{ context.title }}</h1>
        {% endif %}
        {% if context.content %}
          <div>
            {{ context.content_cleaned() | add_preview }}
          </div>
        {% endif %}
        <footer>
          <a href="{{ context.permalink }}">{{ context.published }}</a>
        </footer>
      </article>
    {% endfor %}

    <article>
      <header>
        {% if entry.author_photo %}
          <img src="{{entry.author_photo}}"/>
        {% endif %}
        {% if entry.author_name %}
          {{ entry.author_name }} -
        {% endif %}
        {{ entry.feed.name }}
      </header>
      {% if entry.title %}
        <h1>{{ entry.title }}</h1>
      {% endif %}
      {% if entry.content %}
        <div>
          {{ entry.content_cleaned() | add_preview }}
        </div>
      {% endif %}
      <footer>
        <a href="{{ entry.permalink }}">{{ entry.published }}</a>
        <div class="reply-area">
          {% include '_reply.jinja2' with context %}
        </div>
      </footer>
    </article>
  {% endfor %}

  {% if entries %}
    <div class="pager">
      <a id="older-link" href="{{ url_for_other_page(page=page+1) }}">Older</a>
    </div>
  {% endif %}

{% endblock body %}
