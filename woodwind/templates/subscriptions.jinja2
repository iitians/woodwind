{% extends "base.jinja2" %}

{% block header %}
  {% if current_user.is_authenticated() %}
    <form action="{{ url_for('.subscribe') }}" method="POST">
      <input type="url" id="origin" name="origin" placeholder="Subscribe to URL" />
    </form>
  {% endif %}
{% endblock header %}

{% block body %}

  <article>
    {{ subscriptions | count }} subscriptions

    <form action="{{ url_for('.update_all') }}" method="POST">
      <button type="submit">Poll All</button>
    </form>
  </article>

  {% for s in subscriptions %}

  <article>
      <div>
        <a href="{{ url_for('.index', subscription=s.id) }}">View only posts from this feed</a>
      </div>

      <form action="{{ url_for('.edit_subscription') }}" method="POST">
            <input type="hidden" name="id" value="{{ s.id }}"/>
            <label>Name</label>
            <input type="text" name="name" value="{{  s.name }}"/>
            <label>URL</label>
            <input type="text" name="feed" value="{{ s.feed.feed }}" editable="false" />
            <button type="submit">Save Edits</button>
      </form>

      <form action="{{ url_for('.update_feed') }}" method="POST">
            <input type="hidden" name="id" value="{{ s.feed.id }}"/>
            <button type="submit">Poll Now</button>
      </form>

      <form action="{{ url_for('.unsubscribe') }}" method="POST">
            <input type="hidden" name="id" value="{{ s.id }}"/>
            <button type="submit">Unsubscribe</button>
      </form>


      <a class="show-details" data-target="details-{{loop.index}}" href="#">Show Details</a>

      <div class="feed-details" id="details-{{loop.index}}">
        <strong>Details</strong>
        <ul>
          <li>Last checked: {{s.feed.last_checked | relative_time}}</li>
          <li>Last updated: {{s.feed.last_updated | relative_time}}</li>
          <li>PuSH hub: {{s.feed.push_hub}}</li>
          <li>PuSH topic: {{s.feed.push_topic}}</li>
          <li>PuSH verified: {{s.feed.push_verified}}</li>
          <li>PuSH last ping: {{s.feed.last_pinged | relative_time}}</li>
          <li>PuSH expiry: {{s.feed.push_expiry | relative_time}}</li>
        </ul>
      </div>
    </article>
  {% endfor %}

{% endblock body %}
{% block foot %}
<script>
$(function() {

  $(".feed-details").css({display: "none"});

  $(".show-details").click(function(evt) {
    evt.preventDefault();
    var target = $(this).data("target");
    $("#" + target).css({display: "inherit"});
    $(this).css({display: "none"});
  });

});
</script>

{% endblock foot %}
